/**
  lua - A client side A/B tester
  @version v5.0.3
  @link https://github.com/dollarshaveclub/lua
  @author Okey Amy <amaobiokeoma@gmail.com>
  @license MIT
**/
((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Lua=t()})(this,function(){function o(t){var e=Object.keys(t.buckets),s=[],n=(e.forEach(function(e){e=t.buckets[e].weight;s.push(e=null==e?1:e)}),e),r=s;if(n.length!==r.length)throw new Error("names and weights must have equal length!");for(var e=r.reduce(function(e,t){return e+t},0),i=0,o=a(0,e),u=0;u<n.length;u++)if(o<=(i+=r[u]))return n[u];return n[n.length-1]}var s,a=function(e,t){return Math.random()*(t-e)+e},e=(()=>{function e(e){void 0===e&&(e={}),Object.assign(this,{storageKey:"ab-tests",root:"undefined"!=typeof document?document.body:null},e);e=this.store;if(!e)throw new Error("You must supply a store!");if("function"!=typeof e.get)throw new Error("The store must implement .get()");if("function"!=typeof e.set)throw new Error("The store must implement .set()");if("function"!=typeof e.isSupported)throw new Error("The store must implement .isSupported()");if(!e.isSupported())throw new Error("The store is not supported.");this.previousAssignments={};try{var t=this.store.get(this.storageKey);"string"==typeof t&&"{"===t[0]&&(this.previousAssignments=JSON.parse(t))}catch(e){}this.userAssignments={},this.persistedUserAssignments={},this.providedTests=[]}var t=e.prototype;return t.define=function(e){var t=this,s=e;(s=Array.isArray(e)?s:[e]).forEach(function(e){if(!e.name)throw new Error("Tests must have a name");if(!e.buckets)throw new Error("Tests must have buckets");if(!Object.keys(e.buckets))throw new Error("Tests must have buckets");t.providedTests.push(e)})},t.definitions=function(){return this.providedTests},t.removeClasses=function(t,s){try{var n=this.root;n&&n.className.split(/\s+/g).map(function(e){return e.trim()}).filter(Boolean).filter(function(e){return 0===e.indexOf(t+"--")}).filter(function(e){return e!==s}).forEach(function(e){return n.classList.remove(e)})}catch(e){}},t.applyClasses=function(){var s=this;try{var n=this.userAssignments,r=this.root;r&&Object.keys(n).forEach(function(e){var t=n[e],t=t?e+"--"+t:null;s.removeClasses(e,t),t&&r.classList.add(t)})}catch(e){}},t.assignAll=function(){var n=this.previousAssignments,r=this.userAssignments,i=this.persistedUserAssignments;this.providedTests.forEach(function(t){var s,e=Object.keys(t.buckets).filter(function(e){return t.buckets[e].winner})[0];e?r[t.name]=e:r[t.name]||((e=n[t.name])&&t.buckets[e]?(e=n[t.name],i[t.name]=e,r[t.name]=e,t.active=!0):!1===t.active?r[t.name]=(s=t.buckets,Object.keys(s).filter(function(e){e=s[e];return e.default||e.winner})[0]||Object.keys(s)[0]):(e=o(t),i[t.name]=e,r[t.name]=e))}),this.persist(),this.applyClasses()},t.assign=function(t,e){if(!t)return this.assignAll();var s=this.providedTests.filter(function(e){return e.name===t})[0];null!==e&&s?(e=e||o(s),this.userAssignments[t]=e,this.persistedUserAssignments[t]=e,s.active=!0,this.persist(),this.applyClasses()):(delete this.userAssignments[t],delete this.persistedUserAssignments[t],this.persist(),this.removeClasses(t))},t.extendAssignments=function(e){return e},t.assignments=function(){return this.extendAssignments(this.userAssignments)},t.persist=function(){this.store.set(this.storageKey,JSON.stringify(this.persistedUserAssignments))},e})(),t={browserCookie:{type:"browserCookie",get:function(e){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},set:function(e,t){var s=new Date("12/31/9999").toUTCString();document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; expires="+s+"; path=/"},isSupported:function(){return"undefined"!=typeof document}},local:{type:"local",get:function(e){return localStorage.getItem(e)},set:function(e,t){return localStorage.setItem(e,t)},isSupported:function(){if("undefined"!=typeof localStorage)return!0;var e=new Date;try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}},memory:(s=Object.create(null),{type:"memory",get:function(e){return s[e]},set:function(e,t){s[e]=t},isSupported:function(){return!0}})};return(window.Lua=e).stores=t,e});
